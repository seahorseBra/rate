package com.example.zc.rat;

import android.os.Bundle;
import android.os.Environment;
import android.support.annotation.Nullable;
import android.support.v7.app.AppCompatActivity;
import android.view.View;

import com.alibaba.fastjson.JSON;

import java.io.File;
import java.util.List;

public class TestActivity extends AppCompatActivity {

    private View mPlay;
    private AudioPlayer audioPlayer;
    String array = "[  0.4 ,   0.93,   1.44,   1.95,   2.49,   3.  ,   4.07,   5.12,\n" +
            "         6.18,   7.25,   8.3 ,   9.37,  10.43,  11.49,  12.54,  13.6 ,\n" +
            "        14.65,  15.7 ,  16.75,  17.79,  18.83,  19.89,  20.95,  21.99,\n" +
            "        23.02,  24.05,  25.09,  26.15,  27.2 ,  28.24,  29.25,  30.29,\n" +
            "        31.36,  32.38,  33.43,  34.48,  35.52,  36.57,  37.61,  38.64,\n" +
            "        39.68,  40.72,  41.75,  42.8 ,  43.82,  44.87,  45.9 ,  46.94,\n" +
            "        47.96,  49.  ,  50.04,  51.09,  52.16,  53.21,  54.26,  55.31,\n" +
            "        56.36,  57.39,  58.44,  59.49,  60.55,  61.6 ,  62.65,  63.71,\n" +
            "        64.76,  65.79,  66.84,  67.9 ,  68.98,  70.04,  71.08,  72.13,\n" +
            "        73.19,  74.24,  75.3 ,  76.34,  77.4 ,  78.46,  79.5 ,  80.55,\n" +
            "        81.61,  82.64,  83.69,  84.23,  84.76,  85.29,  85.81,  86.34,\n" +
            "        86.87,  87.41,  87.93,  88.46,  88.97,  89.48,  90.  ,  90.53,\n" +
            "        91.05,  91.58,  92.1 ,  92.64,  93.17,  93.69,  94.21,  95.28,\n" +
            "        96.29,  97.41,  98.5 ,  99.56, 100.61, 101.67, 102.74, 103.8 ,\n" +
            "       104.87, 105.95, 107.02, 108.09, 109.12, 110.18, 111.25, 112.3 ,\n" +
            "       113.35, 114.4 , 115.45, 116.51, 117.54, 118.59, 119.64, 120.69,\n" +
            "       121.73, 122.81, 123.86, 124.9 , 125.92, 126.98, 128.04, 129.06,\n" +
            "       130.09, 131.16, 132.23, 133.29, 134.33, 135.36, 136.4 , 137.44,\n" +
            "       137.96, 138.48, 139.01, 139.54, 140.07, 140.59, 141.64, 142.7 ,\n" +
            "       143.23, 143.75, 144.28, 144.79, 145.32, 145.84, 146.37, 146.9 ,\n" +
            "       147.98, 149.07, 150.13, 151.19, 152.25, 153.31, 153.83, 154.35,\n" +
            "       154.88, 155.4 , 155.93, 156.46, 156.99, 157.52, 158.05, 158.56,\n" +
            "       159.08, 159.61, 160.66, 161.69, 162.21, 162.72, 163.22, 163.74,\n" +
            "       164.25, 164.76, 165.3 , 165.83, 166.36, 166.88, 167.41, 167.92,\n" +
            "       168.45, 168.97, 169.5 , 170.02, 170.54, 171.06, 171.58, 172.1 ,\n" +
            "       172.62, 173.14, 173.66, 174.18, 174.7 , 175.22, 175.75, 176.27,\n" +
            "       176.79, 177.31, 177.83, 178.35, 178.88, 179.4 , 179.92, 180.45,\n" +
            "       180.96, 181.48, 181.99, 182.52, 183.05, 183.58, 184.1 , 184.64,\n" +
            "       185.16, 185.69, 186.21, 186.72, 187.24, 187.76, 188.28, 188.8 ,\n" +
            "       189.33, 189.84, 190.35, 190.87, 191.39, 191.91, 192.45, 192.97,\n" +
            "       194.02, 195.06, 195.57, 196.08, 196.6 , 197.11, 197.62, 198.14,\n" +
            "       198.66, 199.17, 199.69, 200.21, 200.73, 201.24, 201.76, 202.27,\n" +
            "       202.8 , 203.31, 203.82, 204.33, 204.85, 205.36, 205.88, 206.39,\n" +
            "       206.91, 207.43, 207.94, 208.45, 208.97, 209.49, 210.01, 210.52,\n" +
            "       211.04, 211.56, 212.07, 212.6 , 213.13, 213.66, 214.19, 214.71,\n" +
            "       215.23, 215.74, 216.26, 216.77, 217.29, 217.8 , 218.33, 218.84,\n" +
            "       219.35, 219.86, 220.86, 221.9 , 222.92, 223.95, 225.02, 226.05,\n" +
            "       227.06, 228.05, 229.06, 230.04, 231.04, 232.05, 233.07, 234.09,\n" +
            "       234.91, 235.38, 235.88, 236.35, 236.79, 237.3 , 237.78, 238.28,\n" +
            "       238.82, 239.33, 239.83, 240.35, 240.87, 241.41, 241.95, 242.47,\n" +
            "       242.99, 243.52, 244.07, 244.59, 245.11, 245.64, 246.69, 247.75,\n" +
            "       248.8 , 249.85, 250.88, 251.95, 253.01, 254.08, 255.14, 256.2 ,\n" +
            "       257.25, 258.31, 259.36, 260.45, 261.5 , 262.57, 263.63, 264.71,\n" +
            "       265.77, 266.82, 267.89, 268.95, 270.01, 271.07, 272.11, 273.16,\n" +
            "       274.2 , 275.22, 276.23, 277.27, 278.32, 279.36, 280.4 , 281.44,\n" +
            "       282.48, 283.53, 284.6 , 285.64, 286.68, 287.73, 288.77, 289.82,\n" +
            "       290.84, 291.88, 292.92, 293.45, 293.98, 294.51, 295.03, 295.56,\n" +
            "       296.09, 296.63, 297.15, 297.66, 298.18, 298.7 , 299.22, 299.75,\n" +
            "       300.27, 300.8 , 301.32, 301.84, 302.36, 302.9 , 303.43, 303.95,\n" +
            "       304.46, 304.98, 305.49, 306.01, 306.52, 307.02, 307.53, 308.04,\n" +
            "       308.54, 309.05, 309.56, 310.09, 310.6 , 311.1 , 311.61, 312.12,\n" +
            "       312.65, 313.17, 313.72, 314.26, 314.8 , 315.34, 315.88, 316.43,\n" +
            "       316.98, 317.5 , 318.05, 319.13, 320.18, 321.27, 322.36, 323.46,\n" +
            "       324.6 , 325.75, 326.95, 328.02, 329.09, 330.14, 330.99, 331.61,\n" +
            "       332.19, 332.77, 333.21, 334.76, 336.6 , 337.04, 339.1 , 340.6 ,\n" +
            "       340.88, 341.35, 341.6 , 341.85, 342.1 , 342.35, 342.6 , 342.85,\n" +
            "       343.1 , 343.56, 343.85, 344.1 , 344.59, 344.84, 345.09, 345.34,\n" +
            "       345.59, 345.84, 347.48]";
    private List<Float> ratePositions;
    private View red;

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_test);
        ratePositions = JSON.parseArray(array, Float.class);
        mPlay = findViewById(R.id.play);
        red = findViewById(R.id.image);

        mPlay.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                String path = Environment.getExternalStorageDirectory() + "/AArate/hh.wav";
                play(path);
            }
        });
    }


    private void play(String path) {
        audioPlayer = new AudioPlayer();
        audioPlayer.setTarget(new File(path));

        audioPlayer.setListener(new AudioPlayer.OnSeekDuration() {
            @Override
            public void onSeek(float percent, int currentPosition) {
                red.setVisibility(View.INVISIBLE);
                while (!ratePositions.isEmpty()) {
                    Float aFloat = ratePositions.get(0);
                    float index = aFloat * 1000;
                    float dis = currentPosition - index;
                    if (dis < -50) {
                        break;
                    }
                    ratePositions.remove(0);
                    if (Math.abs(dis) <= 50) {
                        red.setVisibility(View.VISIBLE);
                    }
                    break;
                }


            }
        });
        audioPlayer.start();
    }

}
